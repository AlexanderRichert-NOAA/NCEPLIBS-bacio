# @configure_input@

# src/ level makefile template

# Package-specific substitution variables
package = @PACKAGE_NAME@
version = @PACKAGE_VERSION@
tarname = @PACKAGE_TARNAME@
distdir = $(tarname)-$(version)@SUFFIX@

# Prefix-specific substitution variables
prefix = @prefix@

# Mixed package and prefix substitution variables
installdir = $(prefix)/$(distdir)

# Tool-specific substitution variables
FC      = @FC@
FCFLAGS = @FCFLAGS@ -c
CC      = @CC@
CFLAGS  = @CFLAGS@ -c
AR      = @AR@
ARFLAGS = @ARFLAGS@
RANLIB  = @RANLIB@
INSTALL         = @INSTALL@
INSTALL_DATA    = @INSTALL_DATA@
INSTALL_PROGRAM = @INSTALL_PROGRAM@
INSTALL_SCRIPT  = @INSTALL_SCRIPT@

# The library name
LIBRARY = lib$(package).a

# The file definitions. This include must occur before targets.
include make.filelist

# The targets
all: library

$(LIBRARY): $(OBJ_FILES)
	$(AR) $(ARFLAGS) $@ $(OBJ_FILES)
	$(RANLIB) $@
        
library: $(LIBRARY)

clean:
	cd test && $(MAKE) $@
	-rm *.o *.mod *.a

distclean: 
	cd test && $(MAKE) $@
	-rm *.o *.mod *.a
	-rm Makefile

check: library
	cd test && $(MAKE) $@

install_include:
	$(INSTALL) -d $(DESTDIR)$(installdir)/include
	$(INSTALL_DATA) *.mod $(DESTDIR)$(installdir)/include

install_lib:
	$(INSTALL) -d $(DESTDIR)$(installdir)/lib
	$(INSTALL_DATA) lib$(package)$(SUFFIX).a $(DESTDIR)$(installdir)/lib

install: install_include install_lib

nco_install_lib:
	$(INSTALL) -d $(DESTDIR)$(installdir)
	$(INSTALL_DATA) lib$(package)$(SUFFIX).a $(DESTDIR)$(installdir)/lib$(package)-$(version)$(SUFFIX).a

nco_install_include:
	$(INSTALL) -d $(DESTDIR)$(installdir)/incmod/$(distdir)
	$(INSTALL_DATA) *.mod $(DESTDIR)$(installdir)/incmod/$(distdir)

nco_install: nco_install_include nco_install_lib

uninstall:
	-rm -fr $(DESTDIR)$(installdir)

Makefile: Makefile.in ../config.status
	cd .. && ./config.status src/$@

../config.status: ../configure
	cd .. && ./config.status --recheck

# Specify targets that do not generate filesystem objects
.PHONY: all clean distclean check install nco_install uninstall

# Dependency include file
include make.dependencies

# Suffix rules
.SUFFIXES:
.SUFFIXES: .f .c .o
.f.o:
	$(FC) $(EXTRA_FCFLAGS) $(FCFLAGS) $<

.c.o:
	$(CC) $(EXTRA_CFLAGS) $(CFLAGS) $<

